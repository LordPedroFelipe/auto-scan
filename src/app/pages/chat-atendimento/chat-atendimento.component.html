<div class="chat-container">

  <!-- Cabeçalho com imagem do agente -->
  <div class="agente-header">
    <img src="assets/img/ScanDrive-White/9.png" alt="ScanDrive IA" *ngIf="humor === 'happy' || ''" />
    <h2>Atendimento ScanDrive</h2>
    <p>Seu assistente inteligente para compra de veículos</p>
  </div>

  <!-- Carrossel de imagens -->
  <div class="carrossel-veiculo" *ngIf="placa && imagensVeiculo.length">
    <h3>Fotos do veículo</h3>
    <div class="carousel-wrapper">
      <img
        *ngFor="let img of imagensVeiculo"
        [src]="img"
        alt="Imagem do veículo"
        (click)="abrirImagem(img)"
      />
    </div>
  </div>

  <!-- Mensagens do chat -->
  <div class="mensagens" #mensagensDiv>
    <div
      *ngFor="let msg of mensagens"
      [ngClass]="{ 'cliente': msg.autor === 'Cliente', 'ia': msg.autor === 'IA' }"
      class="mensagem-bolha"
    >
      <strong>{{ msg.autor }}:</strong> {{ msg.texto }}

          <!-- Se a mensagem for do tipo com opções -->
      <div *ngIf="msg.opcoes">
        <div class="botoes-sugestoes">
          <button
            mat-stroked-button
            color="primary"
            *ngFor="let op of msg.opcoes"
            (click)="selecionarOpcao(op)"
          >
            {{ op }}
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Campo de entrada -->
  <div class="entrada">
    <input
      type="text"
      [(ngModel)]="novaMensagem"
      placeholder="Digite sua pergunta..."
      (keyup.enter)="enviar()"
      [disabled]="isLoading"
    />

    <button
      mat-icon-button
      (click)="alternarGravacao()"
      [color]="isRecording ? 'warn' : 'accent'"
      matTooltip="Fale com o assistente"
    >
      <mat-icon>{{ isRecording ? 'stop' : 'mic' }}</mat-icon>
    </button>

    <button (click)="enviar()" [disabled]="!novaMensagem.trim() || isLoading">
      <mat-icon *ngIf="!isLoading">send</mat-icon>
      <mat-progress-spinner
        *ngIf="isLoading"
        diameter="20"
        mode="indeterminate"
        color="primary"
      ></mat-progress-spinner>
    </button>
  </div>
  

  <!-- Sugestões rápidas de busca -->
  <!--div class="sugestoes-chat" *ngIf="sugestoesVisiveis.length">
    <h4>Buscas populares:</h4>
    <div class="botoes-sugestoes">
      <button mat-stroked-button color="accent" *ngFor="let sugestao of sugestoesVisiveis" (click)="novaMensagem = sugestao; enviar()">
        {{ sugestao }}
      </button>
    </div>
  </div-->

</div>
